<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"whitetail-o.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.14.2","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="a). Shadow Mapping A 2-Pass Algorithm Light pass: Generate the SM(Shadow Map) Camera pass: uses the SM   An image-space algorithm Pro(优点): no knowledge of scene’s geometry is required Con(缺点): causing">
<meta property="og:type" content="article">
<meta property="og:title" content="Games202-2 Real-Time Shadow">
<meta property="og:url" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/index.html">
<meta property="og:site_name" content="WhiteTail&#39;s Blog">
<meta property="og:description" content="a). Shadow Mapping A 2-Pass Algorithm Light pass: Generate the SM(Shadow Map) Camera pass: uses the SM   An image-space algorithm Pro(优点): no knowledge of scene’s geometry is required Con(缺点): causing">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SM_Pass01.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SM_Pass02.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SM_vs.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SelfOcclusion.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SelfOcclusion_Bias.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/Detached%20shadow.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/Second-depthShadowMapping.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/Aliasing.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/Approximation%20in%20RTR.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/ApproximationinRTR_ShadowMap.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/ShadowMappingApproximation.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/PCF.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS01.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS_Key.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS_How.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS_Region.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/PCF_02.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_01.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_CDF.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_Chebychev.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_step01.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_step01b.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SAT_1D.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SAT_2D.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_Con.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_Con2.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_LightLeaking.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/MSM_Moments.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/MSM_ProAndCons.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/DF.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_01.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_02.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/DistanceField.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/RayMarching.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_SS.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_SS02.png">
<meta property="og:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_SafeAngle.png">
<meta property="article:published_time" content="2023-02-01T08:23:10.000Z">
<meta property="article:modified_time" content="2023-02-03T18:06:10.223Z">
<meta property="article:author" content="WhiteTail">
<meta property="article:tag" content="图形学">
<meta property="article:tag" content="Games202">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/SM_Pass01.png">


<link rel="canonical" href="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/","path":"2023/02/01/Games202_02_Real-Time Shadow/","title":"Games202-2 Real-Time Shadow"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Games202-2 Real-Time Shadow | WhiteTail's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="WhiteTail's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">WhiteTail's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#a-Shadow-Mapping"><span class="nav-text">a). Shadow Mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Pass-1-Render-from-Light"><span class="nav-text">Pass 1: Render from Light</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pass-2-Render-from-Eye-Camera"><span class="nav-text">Pass 2: Render from Eye(Camera)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#a-1-Issues-in-Shadow-Mapping"><span class="nav-text">a.1). Issues in Shadow Mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-1-1-Self-occlusion-%E8%87%AA%E9%81%AE%E6%8C%A1"><span class="nav-text">a.1.1). Self occlusion(自遮挡)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#a-1-2-Detached-shadow"><span class="nav-text">a.1.2). Detached shadow</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#a-1-3-Aliasing"><span class="nav-text">a.1.3). Aliasing</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#b-Math"><span class="nav-text">b). Math</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#b-1-Approximation-in-RTR"><span class="nav-text">b.1). Approximation in RTR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#b-2-%E6%B8%B2%E6%9F%93%E6%96%B9%E7%A8%8B%E7%9A%84%E4%B8%8D%E7%AD%89%E5%BC%8F"><span class="nav-text">b.2). 渲染方程的不等式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#b-3-in-Shadow-Mapping"><span class="nav-text">b.3). in Shadow Mapping</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Small-support"><span class="nav-text">Small support</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Smooth-integrand"><span class="nav-text">Smooth integrand</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#c-PCSS-Percentage-Closer-Soft-Shadow"><span class="nav-text">c). PCSS(Percentage-Closer Soft Shadow)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#c-1-PCF-Percentage-Closer-Filtering"><span class="nav-text">c.1). PCF(Percentage Closer Filtering)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#c-2-PCSS-Percentage-Closer-Soft-Shadow"><span class="nav-text">c.2). PCSS(Percentage-Closer Soft Shadow)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#c-2-1-%E4%BB%80%E4%B9%88%E6%98%AFPCSS%EF%BC%9F"><span class="nav-text">c.2.1). 什么是PCSS？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-2-2-%E5%81%9A%E6%B3%95"><span class="nav-text">c.2.2). 做法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%82%A3%E4%B9%88PCSS%E4%B8%AD%E9%82%A3%E4%BA%9B%E6%AD%A5%E9%AA%A4%E4%BC%9A%E5%AF%BC%E8%87%B4%E9%80%9F%E5%BA%A6%E5%8F%98%E6%85%A2%EF%BC%9F"><span class="nav-text">那么PCSS中那些步骤会导致速度变慢？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-2-3-Math"><span class="nav-text">c.2.3). Math</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#d-Variance-Soft-Shadow-Mapping-VSSM"><span class="nav-text">d). Variance Soft Shadow Mapping(VSSM)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#d-1-Solve-step3-PCF"><span class="nav-text">d.1). Solve step3(PCF)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#d-2-Solve-step1"><span class="nav-text">d.2). Solve step1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#d-3-Summed-Area-Tables-SAT-%E7%A7%AF%E5%88%86%E8%A1%A8"><span class="nav-text">d.3). Summed Area Tables (SAT, 积分表)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#d-4-%E7%BC%BA%E9%99%B7"><span class="nav-text">d.4). 缺陷</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#e-Moment-Shadow-Mapping-MSM"><span class="nav-text">e). Moment Shadow Mapping(MSM)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#f-Distance-Field-Soft-Shadow-SDF-%E6%9C%89%E5%90%91%E8%B7%9D%E7%A6%BB%E5%9C%BA"><span class="nav-text">f). Distance Field Soft Shadow(SDF, 有向距离场)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#f-1-Distance-functions"><span class="nav-text">f.1). Distance functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#f-1-1-Ray-marching"><span class="nav-text">f.1.1). Ray marching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#f-1-2-Soft-Shadow"><span class="nav-text">f.1.2). Soft Shadow</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#f-2-Pros-and-Cons"><span class="nav-text">f.2). Pros and Cons</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="WhiteTail"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">WhiteTail</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://whitetail-o.github.io/2023/02/01/Games202_02_Real-Time%20Shadow/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="WhiteTail">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WhiteTail's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Games202-2 Real-Time Shadow | WhiteTail's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Games202-2 Real-Time Shadow
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-02-01 16:23:10" itemprop="dateCreated datePublished" datetime="2023-02-01T16:23:10+08:00">2023-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-02-04 02:06:10" itemprop="dateModified" datetime="2023-02-04T02:06:10+08:00">2023-02-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Games202/" itemprop="url" rel="index"><span itemprop="name">Games202</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="a-Shadow-Mapping"><a href="#a-Shadow-Mapping" class="headerlink" title="a). Shadow Mapping"></a>a). Shadow Mapping</h1><ul>
<li>A <strong>2-Pass</strong> Algorithm<ol>
<li>Light pass: Generate the SM(Shadow Map)</li>
<li>Camera pass: uses the SM</li>
</ol>
</li>
<li>An image-space algorithm<ul>
<li>Pro(优点): no knowledge of scene’s geometry is required</li>
<li>Con(缺点): causing <strong>self occlusion(自遮挡)</strong> and <strong>aliasing(走样)</strong> issues</li>
</ul>
</li>
</ul>
<h2 id="Pass-1-Render-from-Light"><a href="#Pass-1-Render-from-Light" class="headerlink" title="Pass 1: Render from Light"></a>Pass 1: Render from Light</h2><ul>
<li>输出一张<strong>光源视角</strong>的<strong>深度图（Depth Buffer）</strong></li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SM_Pass01.png" alt="SM_Pass01"></p>
<h2 id="Pass-2-Render-from-Eye-Camera"><a href="#Pass-2-Render-from-Eye-Camera" class="headerlink" title="Pass 2: Render from Eye(Camera)"></a>Pass 2: Render from Eye(Camera)</h2><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SM_Pass02.png" alt="SM_Pass02"></p>
<ul>
<li><p>将光源视角对应的深度转换到View Space, 与Camera视角的深度进行深度比较；</p>
<ul>
<li>如$Depth_{cam} &gt; Depth_{light}$ ，那说明该点<strong>在阴影中</strong>（相机可见，光源不可见）</li>
<li>如$Depth_{cam} &lt; Depth_{light}$ ，那说明该点在<strong>不在阴影中</strong>（相机可见，光源可见）</li>
</ul>
</li>
<li><p><strong>用于比较的深度值：</strong></p>
<ul>
<li><p>经过透视投影中的Squeez矩阵后（具体看Games101 Math笔记），z会被推向远平面</p>
<p>$M_{\text {persp } \rightarrow \text { ortho }}=\left(\begin{array}{cccc}<br>n &amp; 0 &amp; 0 &amp; 0 \\<br>0 &amp; n &amp; 0 &amp; 0 \\<br>0 &amp; 0 &amp; n+f &amp; -nf \\<br>0 &amp; 0 &amp; 1 &amp; 0<br>\end{array}\right)$</p>
</li>
<li><p>用于比较的$Depth$ 可以是经过MVP中的深度值（即Depth Buffer中的深度值）；</p>
</li>
<li>也可以是该点在同一空间（如模型空间）中，该点到相机/光源的线性距离；</li>
</ul>
</li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SM_vs.png" alt="SM_vs"></p>
<hr>
<h2 id="a-1-Issues-in-Shadow-Mapping"><a href="#a-1-Issues-in-Shadow-Mapping" class="headerlink" title="a.1). Issues in Shadow Mapping"></a>a.1). Issues in Shadow Mapping</h2><h3 id="a-1-1-Self-occlusion-自遮挡"><a href="#a-1-1-Self-occlusion-自遮挡" class="headerlink" title="a.1.1). Self occlusion(自遮挡)"></a>a.1.1). Self occlusion(自遮挡)</h3><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SelfOcclusion.png" alt="SelfOcclusion"></p>
<ul>
<li><strong>Self occlusion：</strong> 阴影自遮挡，造成阴影毛刺的现象；</li>
<li><strong>原因：</strong> 如上图，<ul>
<li>Shadow Map分辨率有限，一个像素内记录的深度值相同。如图中红色和橙色斜线表示Shadow Map中深度相同的位置（$Depth_A = Depth_{A’}$）；</li>
<li>当计算平面中$B$点是否在阴影中时，$Depth_{light} = z1 = Depth_A$，而相机视角下的点$B$转换到光源视角下对应的深度为 $z2$ ，即$Depth_{cam} = z2 = Depth_B$</li>
<li>因此，$Depth_{cam} &gt; Depth_{light}$ ，说明该点<strong>在阴影中</strong>，因此造成Self occlusion</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>解决方法：</strong> 引入<strong>Bias</strong>；</p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SelfOcclusion_Bias.png" alt="SelfOcclusion_Bias" style="zoom:50%;"></p>
<ul>
<li>认为对于$B$点，如$Depth_{cam} &gt; Depth_{light}$，但$Depth_{light}$ 处于橙色中，那该点仍然不在阴影中；</li>
<li>即：<ul>
<li>$Depth_{cam} &gt; Depth_{light}+bias$，才使得该点<strong>在阴影中</strong>；</li>
<li>$Depth_{cam} &lt; Depth_{light}+bias$，该点<strong>不在阴影中</strong>；</li>
</ul>
</li>
<li>易得，当光源方向垂直于平面时，所需的Bias最小，因此可引入光源与平面法线的夹角 $cos\alpha$ ，来调整Bias大小；</li>
</ul>
</li>
</ul>
<ul>
<li>引入bias会造成的问题：Detached shadow(不接触阴影，Peter Panning)</li>
</ul>
<h3 id="a-1-2-Detached-shadow"><a href="#a-1-2-Detached-shadow" class="headerlink" title="a.1.2). Detached shadow"></a>a.1.2). Detached shadow</h3><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/Detached shadow.png" alt="Detached shadow"></p>
<ul>
<li><p><strong>解决方法：</strong></p>
<ul>
<li><p>Second-depth shadow mapping</p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/Second-depthShadowMapping.png" alt="Second-depthShadowMapping"></p>
</li>
<li><p>工业界实际没什么人用，只是学术界提出的解决方案</p>
</li>
</ul>
</li>
</ul>
<h3 id="a-1-3-Aliasing"><a href="#a-1-3-Aliasing" class="headerlink" title="a.1.3). Aliasing"></a>a.1.3). Aliasing</h3><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/Aliasing.png" alt="Aliasing"></p>
<h1 id="b-Math"><a href="#b-Math" class="headerlink" title="b). Math"></a>b). Math</h1><h2 id="b-1-Approximation-in-RTR"><a href="#b-1-Approximation-in-RTR" class="headerlink" title="b.1). Approximation in RTR"></a>b.1). Approximation in RTR</h2><ul>
<li><p>RTR中常用的不等式；</p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/Approximation in RTR.png" alt="Approximation in RTR"></p>
<ul>
<li>该不等式“准确”的条件：<ol>
<li><strong>Support（支撑集，积分的范围）足够小时；</strong></li>
<li><strong>$g(x)$ 足够光滑（指频率低，起伏小）</strong></li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="b-2-渲染方程的不等式"><a href="#b-2-渲染方程的不等式" class="headerlink" title="b.2). 渲染方程的不等式"></a>b.2). 渲染方程的不等式</h2><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/ApproximationinRTR_ShadowMap.png" alt="ApproximationinRTR_ShadowMap"></p>
<ul>
<li>$V(p,\omega_i)$为Visibility，阴影因子；</li>
<li>单独拆出Visibility，即<strong>先做shading，后做Visibility，最后相乘</strong></li>
</ul>
<h2 id="b-3-in-Shadow-Mapping"><a href="#b-3-in-Shadow-Mapping" class="headerlink" title="b.3). in Shadow Mapping"></a>b.3). in Shadow Mapping</h2><p>什么情况下，Shadow Mapping（先着色，后计算阴影）是准确的；</p>
<h3 id="Small-support"><a href="#Small-support" class="headerlink" title="Small support"></a>Small support</h3><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/ShadowMappingApproximation.png" alt="ShadowMappingApproximation"></p>
<ul>
<li>在计算阴影中，支撑集小，意味着光源小；</li>
<li>因此，对于<strong>点光源</strong>和<strong>方向光源</strong>，做Shadow Mapping硬阴影结果是准确的；</li>
</ul>
<h3 id="Smooth-integrand"><a href="#Smooth-integrand" class="headerlink" title="Smooth integrand"></a>Smooth integrand</h3><p>对于不等式处理后的渲染方程，$g(x)$ 代表光照。</p>
<ul>
<li>当<strong>$g(x)$ 足够光滑（指频率低，起伏小）</strong>，不等式为准确的；</li>
<li>$L_i$ 光滑，对应光源为<strong>面光源</strong>；</li>
<li>BRDF，即$f_r$ 光滑，对应<strong>Diffuse项</strong>；</li>
<li>即对于光源为面光源的Diffuse项，不等式处理后的渲染方程是准确的；</li>
</ul>
<h1 id="c-PCSS-Percentage-Closer-Soft-Shadow"><a href="#c-PCSS-Percentage-Closer-Soft-Shadow" class="headerlink" title="c). PCSS(Percentage-Closer Soft Shadow)"></a>c). PCSS(Percentage-Closer Soft Shadow)</h1><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS.png" alt="PCSS"></p>
<h2 id="c-1-PCF-Percentage-Closer-Filtering"><a href="#c-1-PCF-Percentage-Closer-Filtering" class="headerlink" title="c.1). PCF(Percentage Closer Filtering)"></a>c.1). PCF(Percentage Closer Filtering)</h2><ul>
<li>PCF用于抗锯齿，而不用于软阴影（用于软阴影的叫PCSS，两者实质是一个东西，但应用不同叫法不同）</li>
<li>在<strong>生成Shadow Map后，阴影比较时（即对阴影比较的结果）</strong>，进行Filtering<ul>
<li>面光源生成Shadow Map：以面光源的中心点(放置相机)生成shadow map</li>
</ul>
</li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/PCF.png" alt="PCF"></p>
<ul>
<li><p><strong>做法：</strong> 不止对着色点与其在Shadow Map中的对应点进行深度比较，而是<strong>着色点深度</strong>与其<strong>在Shadow Map中对应点及其周围点深度</strong>进行比较，最后<strong>对各个Visibility的结果取平均值</strong>（或加权平均）</p>
<ul>
<li><strong>eg1</strong>. $P$点在Cam视角下深度为$Depth_p$，转换到光源视角下深度为$Depth_{p’}$，$Depth_{p’}$ 与其在Shadow Map中对应点周围3x3（<strong>Filter size</strong>）像素进行比较，得到结果<script type="math/tex; mode=display">
\begin{array}{l}
1,0,1 \\
1,0,1 \\
1,1,0
\end{array}</script>取平均得到Visibility为 0.667</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Filter size</strong><ul>
<li>Small -&gt; sharper</li>
<li>Large -&gt; softer</li>
<li>为选取合适的Filter size，产生了PCSS</li>
</ul>
</li>
</ul>
<h2 id="c-2-PCSS-Percentage-Closer-Soft-Shadow"><a href="#c-2-PCSS-Percentage-Closer-Soft-Shadow" class="headerlink" title="c.2). PCSS(Percentage-Closer Soft Shadow)"></a>c.2). PCSS(Percentage-Closer Soft Shadow)</h2><h3 id="c-2-1-什么是PCSS？"><a href="#c-2-1-什么是PCSS？" class="headerlink" title="c.2.1). 什么是PCSS？"></a>c.2.1). 什么是PCSS？</h3><ul>
<li><strong>关键：</strong> 自适应Filter size</li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS01.png" alt="PCSS01"></p>
<ul>
<li>观察可得：<ul>
<li>钢笔（Blocker）与接收平面（Receiver）的距离越小（笔尖），阴影越硬</li>
<li>钢笔（Blocker）与接收平面（Receiver）的距离越大（笔尖），阴影越软</li>
</ul>
</li>
<li>即阴影的软硬程度，一部分取决于Blocker和Receiver的距离</li>
</ul>
<hr>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS_Key.png" alt="PCSS_Key"></p>
<ul>
<li><p>阴影的软硬取决于</p>
<ul>
<li>$w_{Light}$ （光源的宽度）</li>
<li>$d_{Blocker}$ 与 $d_{BtoR}$ 的比值；</li>
</ul>
</li>
<li><p><strong>Blocker定义：</strong></p>
<p>Shading point变换到Light视角，对应深度为$Depth_{scene}$ 。<strong>查询区域内</strong>，深度值$z &lt; Depth_{scene}$ 的texel即为Blocker；</p>
</li>
<li><p>$d_{Blocker}$ 为 <strong>Average blocker distance</strong></p>
<ul>
<li><p><strong>Average blocker distance：</strong> Shadow Map一定范围内的Blocker的深度平均值</p>
</li>
<li><p>类似eg1</p>
<blockquote>
<p><strong>eg1</strong>. $P$点在Cam视角下深度为$Depth_p$，转换到光源视角下深度为$Depth_{p’}$，$Depth_{p’}$ 与其在Shadow Map中对应点周围3x3（<strong>Filter size</strong>）像素进行比较，得到结果</p>
<script type="math/tex; mode=display">
\begin{array}{l}
1,0,1 \\
1,0,1 \\
1,1,0
\end{array}</script><p>取平均得到Visibility为 0.667</p>
</blockquote>
<p>其中，Visibility为0的点，即 处于阴影中，$Depth_{cam} &gt; Depth_{light}+bias$ 的点即为Blocker，对Blocker在Shadow Map中的深度值取平均值，即得到Average blocker distance</p>
</li>
</ul>
</li>
</ul>
<h3 id="c-2-2-做法"><a href="#c-2-2-做法" class="headerlink" title="c.2.2). 做法"></a>c.2.2). 做法</h3><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS_How.png" alt="PCSS_How"></p>
<p>首先将shading point点$x$投应到shadow map上,找到其对应的像素点$P$。PCSS算法的实现流程如下：</p>
<p>第一步：Blocker search，即获取<strong>某个区域</strong>的平均遮挡物深度（在点p附近取一个范围(这个范围是自己定义或动态计算的),将范围内各像素的最小深度与x的实际深度比较,从而判断哪些像素是遮挡物，把所有遮挡物的深度记下来取个平均值作为blocker distance。）</p>
<p>第二步：Penumbra estimation，使用平均遮挡物深度计算滤波核尺寸（用取得的遮挡物深度距离来算在PCF中filtering的范围。）</p>
<script type="math/tex; mode=display">
w_{\text {Penumbra }}=\left(d_{\text {Receiver }}-d_{\text {Blocker }}\right) \cdot w_{\text {Light }} / d_{\text {Blocker }}</script><p>第三步：Percentage Closer Filtering，对应该滤波核尺寸应用PCF算法。</p>
<ul>
<li>如何动态计算Blocker search的<strong>“某个范围”</strong><ul>
<li><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/PCSS_Region.png" alt="PCSS_Region"></li>
<li>Light越远，Region越小；Light越近，Region越大；（好像和图不太对应，如非要对应，就类似与Shadow Map位置不变，Light距离变大/小）</li>
</ul>
</li>
</ul>
<h4 id="那么PCSS中那些步骤会导致速度变慢？"><a href="#那么PCSS中那些步骤会导致速度变慢？" class="headerlink" title="那么PCSS中那些步骤会导致速度变慢？"></a>那么PCSS中那些步骤会导致速度变慢？</h4><ul>
<li><p>第一步：Blocker search，需要多次采样查询深度信息并比较，计算Blocker的平均深度$d_{Blocker}$</p>
</li>
<li><p>第三步：PCF，阴影越软→滤波核尺寸越大→采样查询次数变多→速度变慢</p>
<ul>
<li>由此可见，主要是多次采样并比较的方法使得速度变慢；</li>
</ul>
</li>
<li><p><strong>加速方法：</strong></p>
<ul>
<li>随机采样，后降噪；</li>
</ul>
<blockquote>
<p>如果觉得区域过大不想对每一个texels都进行比较,就可以通过随机采样其中的texels，而不是全部采样，会得到一个近似的结果,近似的结果就可能会导致出现噪声。工业的处理的方式就是先稀疏采样得到一个有噪声的visibility的图,接着再在图像空间进行降噪。</p>
</blockquote>
<ul>
<li><strong>Variance Soft Shadow Mapping(VSSM)</strong></li>
</ul>
</li>
</ul>
<hr>
<h3 id="c-2-3-Math"><a href="#c-2-3-Math" class="headerlink" title="c.2.3). Math"></a>c.2.3). Math</h3><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/PCF_02.png" alt="PCF_02"></p>
<script type="math/tex; mode=display">
V(x)=\sum_{q \in \mathcal{N}(p)} w(p, q) \cdot \chi^{+}\left[D_{\mathrm{SM}}(q)-D_{\text {scene }}(x)\right]</script><ul>
<li>其中$\chi^{+}$ 类似于$step()$ 函数<ul>
<li>$D_{\mathrm{SM}}(q)-D_{\text {scene }}(x) \geq 0$， 即$Depth_{ShadowMap} \geq Depth_{cam}$，$\chi^{+}\left[D_{\mathrm{SM}}(q)-D_{\text {scene }}(x)\right] = 1$</li>
<li>$D_{\mathrm{SM}}(q)-D_{\text {scene }}(x) &lt; 0$， 即$Depth_{ShadowMap} &lt; Depth_{cam}$，$\chi^{+}\left[D_{\mathrm{SM}}(q)-D_{\text {scene }}(x)\right] = 0$</li>
</ul>
</li>
</ul>
<hr>
<h1 id="d-Variance-Soft-Shadow-Mapping-VSSM"><a href="#d-Variance-Soft-Shadow-Mapping-VSSM" class="headerlink" title="d). Variance Soft Shadow Mapping(VSSM)"></a>d). Variance Soft Shadow Mapping(VSSM)</h1><ul>
<li><strong>vs PCSS: </strong> Fast blocker search(step 1) and filtering(step 3)</li>
<li><strong>关键思想：</strong> 只用知道有多少（百分比）的 texels 在着色点前面；</li>
</ul>
<h2 id="d-1-Solve-step3-PCF"><a href="#d-1-Solve-step3-PCF" class="headerlink" title="d.1). Solve step3(PCF)"></a>d.1). Solve step3(PCF)</h2><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_01.png" alt="VSSM_01"></p>
<ul>
<li><p>通过<strong>正态分布（Normal distribution）</strong>，求得着色点的深度在采样点中大概的排位，即可得到<strong>近似</strong>的结果；</p>
<ul>
<li><p>需要定义一个正态分布，需要得知其<strong>均值（mean）</strong>和<strong>方差（variance）</strong></p>
</li>
<li><p><strong>Mean:</strong></p>
<ol>
<li>Hardware MIPMAPing (快，但不一定准确);</li>
<li>Summed Area Tables (SAT, 积分表);</li>
</ol>
</li>
<li><strong>Variance:</strong><ul>
<li>$Var(X) = E(X^2)-E^2(X)$ ，方差等于平方的均值（均方值）减去均值的平方；</li>
<li>只需要在Depth Buffer的空余通道中多存储一个$depth^2$；</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>通过求正态分布$P(x&gt;Depth_{cam}) (Depth_{cam}为着色点转换到光源视角的深度)$ 的面积，即求CDF（<strong>累积分布函数</strong> ）即可求得<em>Visibility</em></p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_CDF.png" alt="VSSM_CDF"></p>
<ul>
<li>CDF(x) 求解：<ol>
<li>查表；</li>
<li>切比雪夫不等式；</li>
</ol>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>切比雪夫不等式</strong>（并不需要知道具体的分布情况，而是通过不等式直接得出，如使用切比雪夫就不用正态分布，只需要求得<strong>均值</strong>和<strong>方差</strong>即可，但是也需要分布情况较为简单）</p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_Chebychev.png" alt="VSSM_Chebychev"></p>
<ul>
<li>通过近似值约等出Visibility的结果，即红色面积；<ul>
<li>（准确的条件：）$t\geq mean$ （但一般不管这个，就理解成约等就行）</li>
</ul>
</li>
<li>至此解决了Step3</li>
</ul>
</li>
</ul>
<h2 id="d-2-Solve-step1"><a href="#d-2-Solve-step1" class="headerlink" title="d.2). Solve step1"></a>d.2). Solve step1</h2><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_step01.png" alt="VSSM_step01"></p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_step01b.png" alt="VSSM_step01b"></p>
<ul>
<li><p>Shading point转换到光源下，</p>
</li>
<li><p><strong>关键式：</strong></p>
<script type="math/tex; mode=display">
\frac{N_{1}}{N} z_{\text {unocc }}+\frac{N_{2}}{N} z_{o c c}=z_{\text {Avg }}</script><ul>
<li>$\frac{N_{1}}{N} = P(x&gt;t)$ ，通过切比雪夫不等式求出；</li>
<li>$\frac{N_{2}}{N} = 1-P(x&gt;t)$</li>
<li>$z_{Avg}$：SM中，采样范围深度均值</li>
<li>$z_{unocc}$：近似等于$t$</li>
<li><strong>最终</strong>，由关键式得出$ z_{o c c}$</li>
</ul>
</li>
</ul>
<h2 id="d-3-Summed-Area-Tables-SAT-积分表"><a href="#d-3-Summed-Area-Tables-SAT-积分表" class="headerlink" title="d.3). Summed Area Tables (SAT, 积分表)"></a>d.3). Summed Area Tables (SAT, 积分表)</h2><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SAT_1D.png" alt="SAT_1D"></p>
<ul>
<li>SAT为数据结构，使用前缀和算法</li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SAT_2D.png" alt="SAT_2D"></p>
<ul>
<li>2D的SAT：每一个点记录左上角区域的和；<ul>
<li>先计算一行的一维SAT；</li>
<li>再对计算后的SAT进行列方向的累加，求出二维的SAT；</li>
</ul>
</li>
<li>求蓝色区域和只需要查询四次SAT即可；</li>
<li>SAT的并行性：<ul>
<li>由于先进行行方向SAT计算，后进行列方向SAT计算，具有一定的并行性；</li>
</ul>
</li>
</ul>
<h2 id="d-4-缺陷"><a href="#d-4-缺陷" class="headerlink" title="d.4). 缺陷"></a>d.4). 缺陷</h2><p>由于使用了切比雪夫不等式或正态分布，隐含了<strong>Shadow Map中对应范围的深度分布要较为简单或接近正态分布</strong></p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_Con.png" alt="VSSM_Con"></p>
<ul>
<li>如上右图，分布主要集中在三个值，过于离散，造成VSSM不准确；</li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_Con2.png" alt="VSSM_Con2"></p>
<ul>
<li><p><strong>Light leaking（漏光）</strong></p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/VSSM_LightLeaking.png" alt="VSSM_LightLeaking"></p>
</li>
</ul>
<h1 id="e-Moment-Shadow-Mapping-MSM"><a href="#e-Moment-Shadow-Mapping-MSM" class="headerlink" title="e). Moment Shadow Mapping(MSM)"></a>e). Moment Shadow Mapping(MSM)</h1><ul>
<li><p>VSSM不够准确，需要用更高的<strong>矩（Moment）</strong>来描述PCF（Use <strong>higher order moments</strong> to represent a distribution）</p>
</li>
<li><p><strong>矩（Moments）：</strong></p>
<ul>
<li><p>Quite a few variations on the definition</p>
</li>
<li><p>We use the simplest:</p>
<p>$x,x^2,x^3,x^4,…$</p>
</li>
<li><p>VSSM中，我们用到了二阶矩（$depth^2$）</p>
</li>
<li>有点类似于展开（比如泰勒展开）；</li>
</ul>
</li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/MSM_Moments.png" alt="MSM_Moments"></p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/MSM_ProAndCons.png" alt="MSM_ProAndCons"></p>
<h1 id="f-Distance-Field-Soft-Shadow-SDF-有向距离场"><a href="#f-Distance-Field-Soft-Shadow-SDF-有向距离场" class="headerlink" title="f). Distance Field Soft Shadow(SDF, 有向距离场)"></a>f). Distance Field Soft Shadow(SDF, 有向距离场)</h1><h2 id="f-1-Distance-functions"><a href="#f-1-Distance-functions" class="headerlink" title="f.1). Distance functions"></a>f.1). Distance functions</h2><ul>
<li><p><strong>定义：</strong> 对于空间中任意一点，其值为<strong>到物体的最近距离</strong>。并且可定义其在内部符号（Signed）为负，在外符号为正，即为有向距离场（Signed Distance Functions, SDF）;</p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/DF.png" alt="DF"></p>
</li>
</ul>
<ul>
<li><p><strong>An Example:</strong> Blending (linear interp.) a moving boundary</p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_01.png" alt="SDF_01"></p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_02.png" alt="SDF_02"></p>
</li>
<li><p><strong>背后理论：</strong> 最优传输（Optimal Transport）</p>
</li>
<li><p><strong>SDF性质：</strong></p>
<ul>
<li>对于刚体，SDF不需要实时计算；<ul>
<li>$n$个刚体运动，对于一个点$P$ ，就有$SDF_1(P), SDF_2(P)……SDF_n(P)$，那该点最后的SDF值即为$min(SDF_1(P), SDF_2(P)……SDF_n(P))$</li>
</ul>
</li>
<li>对于形变的物体，SDF需要实时计算；</li>
</ul>
</li>
<li><p><strong>用途：</strong></p>
<ul>
<li>Ray marching</li>
<li>软阴影</li>
</ul>
</li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/DistanceField.png" alt="DistanceField"></p>
<ul>
<li><strong><font color="red">WARNING：不要看到图形就认为SDF是存储一张图形，SDF是三维存储，对于空间中每一个点都有其SDF值</font></strong></li>
</ul>
<h3 id="f-1-1-Ray-marching"><a href="#f-1-1-Ray-marching" class="headerlink" title="f.1.1). Ray marching"></a>f.1.1). Ray marching</h3><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/RayMarching.png" alt="RayMarching"></p>
<ul>
<li><p><strong>作用：</strong>Ray marching(sphere tracing)用来<strong>在SDF中射线与物体求交</strong></p>
</li>
<li><p><strong>关键思想：</strong></p>
<p><strong>SDF中一点的值，即是该点与周围物体不相交的“安全距离”</strong>。如对于点$P$，在周围半径为$SDF(P)$ 的距离内，不与物体相交；</p>
<ul>
<li>因此，以图为例，求SDF中射线与物体相交只需要依次步进$SDF(P)$ , $SDF(A)$ , $SDF(P)$，只需要终点的$SDF(Last)$ 小于一定值，即该点为交点（或一定次数步进后仍没交点，说明该点无交点）</li>
</ul>
</li>
</ul>
<h3 id="f-1-2-Soft-Shadow"><a href="#f-1-2-Soft-Shadow" class="headerlink" title="f.1.2). Soft Shadow"></a>f.1.2). Soft Shadow</h3><p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_SS.png" alt="SDF_SS"></p>
<ul>
<li><p><strong>作用：</strong> 使用SDF来近似表现遮挡百分比（<em>Visibility</em>）</p>
</li>
<li><p><strong>关键思想：</strong></p>
<p><strong>SDF中一点的值，即是该点实现不被某一物体遮挡“安全角度”</strong></p>
<ul>
<li>如着色点$P$看向面光源$AB$，通过得到射向面光源中点的Ray marching来得到”安全角度”。通过安全角度在总角度中的占比，来近似<em>Visibility</em></li>
<li><strong>Smaller “safe” angle &lt;-&gt; less visibility</strong></li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>安全角度：</strong></p>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_SS02.png" alt="SDF_SS02"></p>
<ul>
<li><strong>缺点：</strong> 在shader中涉及反三角函数，开销大；</li>
</ul>
<p><img src="/2023/02/01/Games202_02_Real-Time%20Shadow/SDF_SafeAngle.png" alt="SDF_SafeAngle"></p>
<ul>
<li>因此用<script type="math/tex; mode=display">
\min \left\{\frac{k \cdot \operatorname{SDF}(p)}{|p-o|}, 1.0\right\}</script>来替代，并用 <strong>$k$ 控制阴影的软硬程度</strong>；</li>
</ul>
</li>
</ul>
<h2 id="f-2-Pros-and-Cons"><a href="#f-2-Pros-and-Cons" class="headerlink" title="f.2). Pros and Cons"></a>f.2). Pros and Cons</h2><ul>
<li><strong>Pros</strong><ul>
<li>快（使用角度，不考虑生成）</li>
<li>高质量</li>
</ul>
</li>
<li><strong>Cons</strong><ul>
<li>需要预计算</li>
<li>需要额外存储（不仅仅是图形，而是需要<strong>三维空间存储</strong>）</li>
<li>对于形变物体需要大量实时计算</li>
<li>……</li>
</ul>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" rel="tag"># 图形学</a>
              <a href="/tags/Games202/" rel="tag"># Games202</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/02/01/Games202_01_Recap%20of%20CG%20Basics/" rel="prev" title="Games202-1 Recap of CG Basics">
                  <i class="fa fa-chevron-left"></i> Games202-1 Recap of CG Basics
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/02/01/Games202_03_Real-time%20Environment%20Mapping/" rel="next" title="Games202-3 Real-time Environment Mapping">
                  Games202-3 Real-time Environment Mapping <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WhiteTail</span>
</div>



    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
